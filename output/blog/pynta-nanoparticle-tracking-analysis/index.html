<!DOCTYPE html>
<html lang="en">

<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CYPVPEJ4PK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-CYPVPEJ4PK');
</script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <title>PyNTA: Nanoparticle Tracking Analysis | Python For The Lab</title>

  <meta name="tags" content="Nanoparticle, Tracking, Analysis, Release, Package, Desktop, Experiment, ">
  <meta name="description" content="A Python desktop application for nanoparticle tracking and analysis">
  <meta name="author" content="Aquiles Carattino">

  <link rel="apple-touch-icon" sizes="57x57"
        href="https://www.pythonforthelab.com/theme/css/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60"
        href="https://www.pythonforthelab.com/theme/css/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72"
        href="https://www.pythonforthelab.com/theme/css/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76"
        href="https://www.pythonforthelab.com/theme/css/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114"
        href="https://www.pythonforthelab.com/theme/css/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120"
        href="https://www.pythonforthelab.com/theme/css/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144"
        href="https://www.pythonforthelab.com/theme/css/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152"
        href="https://www.pythonforthelab.com/theme/css/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180"
        href="https://www.pythonforthelab.com/theme/css/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"
        href="https://www.pythonforthelab.com/theme/css/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32"
        href="https://www.pythonforthelab.com/theme/css/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96"
        href="https://www.pythonforthelab.com/theme/css/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16"
        href="https://www.pythonforthelab.com/theme/css/favicon/favicon-16x16.png">
  <link rel="manifest" href="https://www.pythonforthelab.com/theme/css/favicon/manifest.json"/>
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="https://www.pythonforthelab.com/theme/css/favicon/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;700&display=swap"
      rel="stylesheet">

  <link rel="stylesheet" href="https://www.pythonforthelab.com/theme/css/style.css">
  <link rel="stylesheet" href="https://files.stork-search.net/basic.css"/>	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script type="text/javascript" src="https://www.pythonforthelab.com/theme/js/jquery-migrate-1.2.1.js"></script>

	<script src="https://www.pythonforthelab.com/theme/js/functions.js"></script>  <link rel="stylesheet" href="https://www.pythonforthelab.com/theme/css/prism.css"/>
</head>



<body>
  <!-- Wrapper -->
  <section class="wrapper">

<!-- Intro -->
<div class="intro blog article">
  <div class="container">
    <!-- Header -->
    <div class="header">
      <a href="/" class="logo">Python for the Lab</a>
      <div class="header-dd">
        <div class="navigation">
          <ul>
            <li class="active"><a href="https://www.pythonforthelab.com/blog" class="nav-item blog"><span>Blog</span></a></li>
            <li><a href="https://www.pythonforthelab.com/hire-me/" class="nav-item hire-me"><span>Hire Me</span></a></li>
            <li><a href="https://github.com/PFTL/pftl_discussions/discussions" target="_blank"
                   class="nav-item forum"><span>Forum</span></a></li>
            <li><a href="https://www.pythonforthelab.com/books" class="nav-item books"><span>Books</span></a></li>
            <li><a href="https://www.pythonforthelab.com/about" class="nav-item about"><span>About</span></a></li>
          </ul>
        </div>
        <div class="search field-wp">
          <form action="#">
            <input data-stork="sitesearch" type="text" class="field" placeholder="Type to Search">
            <input type="submit" class="search-btn">
          </form>
          <div data-stork="sitesearch-output"></div>
        </div>
      </div>
      <button class="menu-btn"><span>Menu</span></button>
    </div>
    <!-- End Header -->

    <!-- Intro Cnt -->
    <div class="intro-cnt v-article">
      <div class="side-text">
      </div>
      <div class="side-form small-sb-form">
        <div class="sb-form" id="mc_embed_signup">
          <h4>Get all the information directly to your inbox</h4>
          <form
              action="https://pythonforthelab.us21.list-manage.com/subscribe/post?u=f0d9bfa6188cdcc67890a07f6&amp;id=8a0ca536e8&amp;f_id=00dfebe6f0"
              method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate"
              target="_self"
              novalidate="">
            <div class="field-wp" id="mc_embed_signup_scroll">
              <input type="email" name="EMAIL" id="mce-EMAIL" class="field" placeholder="Your E-Mail" required=""
                     value="">
            </div>
            <div style="position: absolute; left: -5000px;" aria-hidden="true">
              /* real people should not fill this in and expect good things - do not remove this or risk form bot
              signups */
              <input type="text" name="b_f0d9bfa6188cdcc67890a07f6_8a0ca536e8" tabindex="-1" value="">
            </div>
            <input type="submit" class="send-btn" value="Subscribe to the Newsletter" name="subscribe"
                   id="mc-embedded-subscribe">
            <span class="small-text">Get relevant information, unsubscribe at any time.</span>
          </form>
        </div>
      </div>
    </div>
    <!-- End Intro Cnt -->

  </div>
</div>
<!-- End Intro -->
    <!-- Main -->
    <div class="main">
      <div class="container">

        <div class="article-cnt">
          <div class="leftside">
            <div class="article-image">
              <img src="https://www.pythonforthelab.com//images/pynta_screenshot_linkedin.width-800.png" alt="" width="800">
            </div>
            <h1>PyNTA: Nanoparticle Tracking Analysis</h1>
            <h3>A Python desktop application for nanoparticle tracking and analysis</h3>
            <div class="info">
              <span class="item-1 author">by Aquiles Carattino</span>
              <span class="item-1 date">2018-12-14</span>
                <span class="item-tag first">Nanoparticle</span>
                <span class="item-tag ">Tracking</span>
                <span class="item-tag ">Analysis</span>
                <span class="item-tag ">Release</span>
                <span class="item-tag ">Package</span>
                <span class="item-tag ">Desktop</span>
                <span class="item-tag ">Experiment</span>
            </div>
            <main>
              <p><a href="https://pypi.org/project/pynta/">PyNTA</a> is a program that aims at
bridging the gap between data acquisition and analysis for experiments
of nanoparticle tracking. PyNTA is my first public release of a package
on PyPI, the Python repository. It is a desktop application that can be
used to record images from a camera, track nanoparticles and build
histograms of the distribution of sizes. It is still in beta, but the
basic functionality is there.</p>
<p>The science behind nanoparticle tracking analysis is relatively simple.
Assuming that the movement of particles is related to Brownian
diffusion, and knowing the properties of the medium (viscosity,
temperature), it is possible to derive the diameter of a particle.
Therefore, the only thing we need to do is to identify particles in each
frame and then link the locations of subsequent frames in order to build
tracks to analyze.</p>
<p>Fortunately, Python already counts with a robust package for the data
analysis, called
<a href="http://soft-matter.github.io/trackpy/v0.4.1/">Trackpy</a>. What trackpy
does not do is the acquisition and real-time data analysis. There is
where PyNTA comes into play. Pynta was built on top of a previous
package, called <a href="https://uutrack.readthedocs.io/en/latest/">UUTrack</a>.
However, the real-time data analysis required specific handling, since
tasks are computationally intensive, it is imperative to use different
cores on the computer.</p>
<p>PyNTA follows the <a href="https://www.uetke.com/blog/general/the-mvc-pattern-for-lab-projects/">MVC
pattern</a>,
making it future-proof and easy to expand. Controllers and the View
don't include anything particularly new, but the model is where the
majority of the work was focused. First, a base experiment class was
developed, seeking at opening the door of developing experiments to a
separated framework in the future. The base experiment implements two
very interesting patterns: <strong>Publishers</strong> and <strong>Subscribers</strong>.</p>
<h2>ZMQ for inter-process communication</h2>
<p>A requirement for PyNTA was to be able to adjust the number of processes
at runtime. This means that, for example, the feed from the camera could
be sent to a process that saves the images to disk. It could also be
sent to a process to identify particles on every image. However, this
decision will be made by the user of the program at any stage of the
workflow. In order to achieve this behavior, I have used the
publisher/subscriber architecture provided by pyZMQ, which is based on
sockets.</p>
<p>Therefore, the experiment model sets up a publisher which is
continuously reading from a Queue and publishes the messages to
whichever subscriber may be listening. Subscribers are independent
processes which listen on a specific port and topic. When data is
received, they run a specific method on the data received. For instance,
they save the data to a hard drive or run trackpy on each frame, etc.
This approach seemed like a relatively simple idea for a complex
problem. It avoids complicated checks to accumulate queues, etc.</p>
<p>The main problem is that all processes start from the same objects, and
my objective was to keep them centralized, adding few decorators to make
development very simple. However, Windows spawns processes instead of
forking them. Meaning that every time you start a new process, the
memory status is point blank. In Linux, the behavior is very different,
since the memory is copied to the new process. This, in practical
matters, means that on windows you can't start a new process for a
method, but only for functions.</p>
<p>In order to develop PyNTA, careful planning of functions was needed,
making the codebase harder to follow. In any case, the end product is a
decentralized code that can be independently improved. This modularity
makes it ideal to test new algorithms for tracking or saving without
breaking the downstream code. It also opens the door for interesting
patterns in the future, leveraging the power of modern computers to new
extents while doing data acquisition.</p>
<h2>Current Limitations</h2>
<p>pyZMQ implements a convenience method called <code>send_pyobj</code> which
serializes objects with cPickle before sending them. There is a
correspondent <code>recv_pyobj</code> which does the opposite. Adding objects to a
queue follows the same procedure, they get serialized and deserialized.
Even if it is convenient not to think about this, in the current status
of the program data sent by the publisher gets
serialized/deserialized/serialized/deserialized. Which is a big overhead
for fast acquisition routines like the one PyNTA tries to tackle.</p>
<p>Better control of the data flow can help increase the response time of
the program. Also, other messages alternatives can be better suited for
inter-process communications, such as pyMPI. The advantage of ZMQ over
MPI is that it allows expanding the architecture to a distributed
network of computers. For instance, one can acquire data and send it
over the network to be stored/analyzed, etc. in a different location.
The opposite is also true, it is possible to think in remotely
controlling the experiments through the use of sockets.</p>
<p>I have tested the program with synthetic images at 100fps, with an
average of 50 particles on each frame, and the program was able to keep
up the pace. It may slightly depend on the computer specifications, but
any dual-core computer should suffice. However, higher resolution
images, where each particle occupies more than around 10 pixels become
excruciatingly slow. This is due to the algorithm to locate particles
and the number of computations increasing with particle size.</p>
<p>Right now the program does not include ways of pre-processing data
before sending to a tracking algorithm, such as background reduction,
reduction of resolution, etc. These, however, are easy to implement in
the experiment model as different acquisition routines that can be
triggered either from the command line or from a GUI.</p>
<h2>Wish list for Pynta</h2>
<p>PyNTA was released in order to open the door to collaboration. However,
there is still a long way for it to become a stable product. The
features that PyNTA needs to implement in order to become more complete
are:</p>
<ul>
<li>Load saved data and analyze it</li>
<li>Produce reports for less technical users</li>
<li>Implement extra parameters for linking locations</li>
<li>Improve visualization of linking status (i.e. show tracks faster in
    order to make better decisions)</li>
<li>Improve results by adding the Walker algorithm</li>
<li>Systematize the publisher/subscriber pattern to make it clearer for
    later developers</li>
<li>Explore pyMPI as a possible message exchanging approach</li>
<li>Simplify serialization/deserialization in order to speed up
    communication</li>
<li>Think about a zero-copy numpy exchange of arrays</li>
</ul>
<h2>Possible Roadmap</h2>
<p>There are different options that can sprout out of PyNTA. For example,
developing a framework to perform experiments with a common pattern of
subscribers and publishers. With the experience gained in PyNTA, there
is a clear path for abstracting common functions. Moreover, pyZMQ opens
the door to a very interesting approach that would allow running the
experiment completely independent from the GUI. This would prevent
problems if the GUI crashes, for example. Moreover one could think about
having GUI's for different platforms that run on the same hardware. For
example, an app on the phone could control the experiment in the same
way that a user sitting on the computer in the lab.</p>
<h2>Getting PyNTA</h2>
<p>If you are intrigued by PyNTA, you can install it by simply running:</p>
<pre><code class="language-bash">pip install pynta
</code></pre>
<p>And you can start it by running:</p>
<pre><code class="language-bash">pynta
</code></pre>
<p>The documentation is available <a href="https://nanoepics.github.io/pynta/">on
Github</a>. It is still a work in
progress, but it is already quite complete. The code is in <a href="https://github.com/nanoepics/pynta">this
repository</a>.</p>
            </main>
            <div class="info-list">
              <span class="item author">Article written by Aquiles Carattino</span>
            </div>
            <div class="bottom-section">
              <h4>Share your thoughts with us!</h4>
              <div class="comments">
                <!-- Comment -->
                <script src="https://utteranc.es/client.js"
                        repo="PFTL/pftl_discussions"
                        issue-term="pathname"
                        label="Comment"
                        theme="github-light"
                        crossorigin="anonymous"
                        async>
                </script>
              </div>
            </div>
          </div>
          <div class="rightside">
            <div class="support-box">
              <h3>Support Us</h3>
              <p>If you like the content of this website, consider buying a copy of the book <strong>Python For The
                Lab</strong></p>
              <a href="https://www.pythonforthelab.com/books" class="button">Check out the book</a>
            </div>
            <div class="latest-posts">

                <h3>Latest Articles</h3>
                <ul>
                    <li>
                      <a href="https://www.pythonforthelab.com/blog/instructions-to-build-the-python-for-the-lab-daq/">Instructions to build the Python for the Lab DAQ</a>
                      <span>by Aquiles Carattino, 2021-03-27</span>
                    </li>
                    <li>
                      <a href="https://www.pythonforthelab.com/blog/using-slots-in-python-limit-dynamic-attribute-creation-and-improve-speed">Using slots in Python: limit dynamic attribute creation and improve speed</a>
                      <span>by Aquiles Carattino, 2021-03-21</span>
                    </li>
                    <li>
                      <a href="https://www.pythonforthelab.com/blog/getting-started-with-basler-cameras">Acquiring images from Basler Cameras</a>
                      <span>by Aquiles Carattino, 2021-02-27</span>
                    </li>
                    <li>
                      <a href="https://www.pythonforthelab.com/blog/singletons-instantiate-objects-only-once">Singletons: Instantiate objects only once</a>
                      <span>by Aquiles Carattino, 2021-01-16</span>
                    </li>
                    <li>
                      <a href="https://www.pythonforthelab.com/blog/differences-between-multiprocessing-windows-and-linux">Differences of Multiprocessing on Windows and Linux</a>
                      <span>by Aquiles Carattino, 2020-06-13</span>
                    </li>
                    <li>
                      <a href="https://www.pythonforthelab.com/blog/python-tip-using-else-loops">Python Tip: Using Else with Loops</a>
                      <span>by Aquiles Carattino, 2020-05-25</span>
                    </li>
                    <li>
                      <a href="https://www.pythonforthelab.com/blog/python-tip-ready-publish-matplotlib-figures">Python Tip: Ready to Publish Matplotlib Figures</a>
                      <span>by Aquiles Carattino, 2020-05-18</span>
                    </li>
                    <li>
                      <a href="https://www.pythonforthelab.com/blog/data-descriptors-bringing-attributes-next-level">Data Descriptors: Bringing Attributes to the Next level</a>
                      <span>by Aquiles Carattino, 2020-05-16</span>
                    </li>
                    <li>
                      <a href="https://www.pythonforthelab.com/blog/python-tips-using-sets">Python Tips: Using Sets</a>
                      <span>by Aquiles Carattino, 2020-05-11</span>
                    </li>
                    <li>
                      <a href="https://www.pythonforthelab.com/blog/generators-iterables-iterators-python-when-and-where">Generators, Iterables, Iterators in Python: When and Where</a>
                      <span>by Aquiles Carattino, 2020-04-10</span>
                    </li>
                </ul>

            </div>
            <div class="subscribe-fixed">
              <button class="action">Never Stop Learning</button>
              <div class="cnt">
                <p>Join over 1000 Python developers and don't miss any updates!</p>
                <form
                    action="https://pythonforthelab.us21.list-manage.com/subscribe/post?u=f0d9bfa6188cdcc67890a07f6&amp;id=8a0ca536e8&amp;f_id=00dfebe6f0"
                    method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate"
                    target="_self" novalidate=""
                >
                  <div id="mc_embed_signup" class="field-wp">
                    <input type="email" name="EMAIL" class="field required email" placeholder="Your E-Mail" id="mce-EMAIL" required="" value="">
                  </div>
                  <div id="mce-responses" class="clear foot">
                  <div class="response" id="mce-error-response" style="display: none;"></div>
                  <div class="response" id="mce-success-response" style="display: none;"></div>
                </div>
                  <div style="position: absolute; left: -5000px;" aria-hidden="true">
                  /* real people should not fill this in and expect good things - do not remove this or risk form bot
                  signups */
                  <input type="text" name="b_f0d9bfa6188cdcc67890a07f6_8a0ca536e8" tabindex="-1" value="">
                </div>
                  <input type="submit" class="send-btn" value="Subscribe to the Newsletter" name="subscribe" id="mc-embedded-subscribe">
                </form>
                <p>Or check out our <a href="/books">books</a>! <br> <a href="#">Privacy Policy</a></p>
              </div>
            </div>
          </div>
        </div>

        <div class="mobile-sb-form">
          <div class="sb-form">
            <h4>Get all the information directly to your inbox</h4>
            <form
                    action="https://pythonforthelab.us21.list-manage.com/subscribe/post?u=f0d9bfa6188cdcc67890a07f6&amp;id=8a0ca536e8&amp;f_id=00dfebe6f0"
                    method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate"
                    target="_self" novalidate=""
                >
                  <div id="mc_embed_signup" class="field-wp">
                    <input type="email" name="EMAIL" class="field required email" placeholder="Your E-Mail" id="mce-EMAIL" required="" value="">
                  </div>
                  <div id="mce-responses" class="clear foot">
                  <div class="response" id="mce-error-response" style="display: none;"></div>
                  <div class="response" id="mce-success-response" style="display: none;"></div>
                </div>
                  <div style="position: absolute; left: -5000px;" aria-hidden="true">
                  /* real people should not fill this in and expect good things - do not remove this or risk form bot
                  signups */
                  <input type="text" name="b_f0d9bfa6188cdcc67890a07f6_8a0ca536e8" tabindex="-1" value="">
                </div>
                  <input type="submit" class="send-btn" value="Subscribe to the Newsletter" name="subscribe" id="mc-embedded-subscribe">
                </form>
          </div>
        </div>

      </div>
    </div>
    <!-- End Main -->

  </section>
  <!-- End Wrapper -->

<!-- Footer -->
<div class="footer">
  <div class="container">
    <div class="footer-cnt">
      <p class="left">
        &copy; Python For The Lab <span class="current-year">2023</span>
      </p>
      <p class="center">
        <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
          <img alt="Creative Commons License"
               style="border-width:0"
               src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/></a>.
      </p>
      <p class="right">
        <a href="https://www.pythonforthelab.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.pythonforthelab.com/privacy-policy">Privacy Policy</a>
      </p>
    </div>
  </div>
</div>
<!-- End Footer --><script src="https://www.pythonforthelab.com/theme/js/prism.js"></script>
<script src="https://files.stork-search.net/releases/v1.5.0/stork.js"></script>
<script>
    stork.register("sitesearch", "https://www.pythonforthelab.com/search-index.st");
</script></body>
</html>