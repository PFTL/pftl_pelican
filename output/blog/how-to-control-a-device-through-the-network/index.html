<!doctype html><html lang=en><script async src=https://www.googletagmanager.com/gtag/js?id=G-CYPVPEJ4PK></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-CYPVPEJ4PK')</script><meta charset=utf-8><meta content=width=device-width,initial-scale=1 name=viewport><title>How to Control a Device Through the Network | Python For The Lab</title><meta content="Network, Communication, Async, Remote Control, Devices, Drivers, Flask, Internet, " name=tags><meta content="Step by step tutorial on how to exchange information with a device
through the network
" name=description><meta content="Aquiles Carattino" name=author><link href=blog/how-to-control-a-device-through-the-network rel=canonical><meta content="Python for the Lab" property=og:site_name><meta content=article property=og:type><meta content=blog/how-to-control-a-device-through-the-network property=og:url><meta content="How to Control a Device Through the Network" property=og:title><meta content="Step by step tutorial on how to exchange information with a device
through the network
" property=og:description><meta content=/images/network_cables_linkedin.width-800.jpg property=og:image><meta content=summary_large_image property=twitter:card><meta content=blog/how-to-control-a-device-through-the-network property=twitter:url><meta content="How to Control a Device Through the Network" property=twitter:title><meta content="Step by step tutorial on how to exchange information with a device
through the network
" property=twitter:description><meta content=/images/network_cables_linkedin.width-800.jpg property=twitter:image><meta content=@aquicarattino name=twitter:creator><link href=http://localhost:8000/theme/css/favicon/apple-icon-57x57.png rel=apple-touch-icon sizes=57x57><link href=http://localhost:8000/theme/css/favicon/apple-icon-60x60.png rel=apple-touch-icon sizes=60x60><link href=http://localhost:8000/theme/css/favicon/apple-icon-72x72.png rel=apple-touch-icon sizes=72x72><link href=http://localhost:8000/theme/css/favicon/apple-icon-76x76.png rel=apple-touch-icon sizes=76x76><link href=http://localhost:8000/theme/css/favicon/apple-icon-114x114.png rel=apple-touch-icon sizes=114x114><link href=http://localhost:8000/theme/css/favicon/apple-icon-120x120.png rel=apple-touch-icon sizes=120x120><link href=http://localhost:8000/theme/css/favicon/apple-icon-144x144.png rel=apple-touch-icon sizes=144x144><link href=http://localhost:8000/theme/css/favicon/apple-icon-152x152.png rel=apple-touch-icon sizes=152x152><link href=http://localhost:8000/theme/css/favicon/apple-icon-180x180.png rel=apple-touch-icon sizes=180x180><link href=http://localhost:8000/theme/css/favicon/android-icon-192x192.png rel=icon sizes=192x192 type=image/png><link href=http://localhost:8000/theme/css/favicon/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=http://localhost:8000/theme/css/favicon/favicon-96x96.png rel=icon sizes=96x96 type=image/png><link href=http://localhost:8000/theme/css/favicon/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=http://localhost:8000/theme/css/favicon/manifest.json rel=manifest><meta content=#ffffff name=msapplication-TileColor><meta content=http://localhost:8000/theme/css/favicon/ms-icon-144x144.png name=msapplication-TileImage><meta content=#ffffff name=theme-color><link href=https://fonts.googleapis.com rel=preconnect><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href=https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;700&display=swap rel=stylesheet><link href=http://localhost:8000/theme/css/style.css rel=stylesheet><link href=https://files.stork-search.net/basic.css rel=stylesheet><link href=https://http://localhost:8000/feed.rss rel=alternate title=RSS type=application/rss+xml><script src=https://code.jquery.com/jquery-3.4.1.min.js></script><script src=http://localhost:8000/theme/js/jquery-migrate-1.2.1.js></script><script src=http://localhost:8000/theme/js/functions.js></script><link href=http://localhost:8000/theme/css/prism.css rel=stylesheet><body><section class=wrapper><div class="intro blog article"><div class=container><div class=header><a class=logo href=/>Python for the Lab</a><div class=header-dd><div class=navigation><ul><li class=active><a class="nav-item blog" href=http://localhost:8000/blog><span>Blog</span></a><li><a class="nav-item hire-me" href=http://localhost:8000/hire-me/><span>Hire Me</span></a><li><a class="nav-item forum" href=https://github.com/PFTL/pftl_discussions/discussions target=_blank><span>Forum</span></a><li><a class="nav-item books" href=http://localhost:8000/books><span>Books</span></a><li><a class="nav-item about" href=http://localhost:8000/about><span>About</span></a></ul></div><div class="search field-wp"><form action=#><input placeholder="Type to Search" class=field data-stork=sitesearch><input class=search-btn type=submit></form><div data-stork=sitesearch-output></div></div></div><button class=menu-btn><span>Menu</span></button></div><div class="intro-cnt v-article"><div class=side-text></div><div class="side-form small-sb-form"><div class=sb-form id=mc_embed_signup><h4>Get all the information directly to your inbox</h4><form action=https://pythonforthelab.us21.list-manage.com/subscribe/post?u=f0d9bfa6188cdcc67890a07f6&id=8a0ca536e8&f_id=00dfebe6f0 class=validate id=mc-embedded-subscribe-form method=post name=mc-embedded-subscribe-form novalidate><div class=field-wp id=mc_embed_signup_scroll><input placeholder="Your E-Mail" class=field id=mce-EMAIL name=EMAIL required type=email></div><div aria-hidden=true style=position:absolute;left:-5000px>/* real people should not fill this in and expect good things - do not remove this or risk form bot signups */ <input name=b_f0d9bfa6188cdcc67890a07f6_8a0ca536e8 tabindex=-1></div><input value="Subscribe to the Newsletter" class=send-btn id=mc-embedded-subscribe name=subscribe type=submit><span class=small-text>Get relevant information, unsubscribe at any time.</span></form></div></div></div></div></div><div class=main><div class=container><div class=article-cnt><div class=leftside><div class=article-image><img alt src=http://localhost:8000//images/network_cables_linkedin.width-800.jpg width=800></div><h1>How to Control a Device Through the Network</h1><h3>Step by step tutorial on how to exchange information with a device through the network</h3><div class=info><span class="item-1 author">by Aquiles Carattino</span><span class="item-1 date">2018-02-28</span><span class="item-tag first">Network</span><span class=item-tag>Communication</span><span class=item-tag>Async</span><span class=item-tag>Remote Control</span><span class=item-tag>Devices</span><span class=item-tag>Drivers</span><span class=item-tag>Flask</span><span class=item-tag>Internet</span></div><main><p>In the lab, it is common to find different computers connected to specific devices. For example,when you keep older PCs which are able to communicate with very specific hardware. You may also have different computers when there are mobile instruments that you share among different users. In these situations it becomes very useful to be able to exchange information between your main computer and a secondary one.<p>A computer network utilizes two elements: a server and a client. The server receives the messages you send, interprets them and returns values if asked to. The client communicates with the server, sends commands and receives data. Internet works this way: when you entered this website, you used a browser, the client, to access content on a server. Communicating with a device connected to another computer is, therefore, not different from what we have just described.<p>If you look around for Python frameworks to build web applications, you will find several but two are going to stand out: <a href=https://www.djangoproject.com/>Django</a> and <a href=http://flask.pocoo.org/>Flask</a>. Django is a complete package for developing web applications, but a total overkill for our purposes. Flask is slightly more barebones, but it provides all the functionality that we are looking for: to create a server that will take inbound communication and act accordingly, for example by triggering a measurement on a device.<p>Installing Flask doesn't take much more than a pip command:<pre><code class=language-bash>pip install Flask
</code></pre><p>After that we can build our first very simple app to see that everything is working fine:<pre><code class=language-python>from flask import Flask
app = Flask(__name__)

@app.route('/')
def index():
   return "The Server is up and running"

app.run()
</code></pre><p>If you run the file, open a browser, and head to <code>localhost:5000</code> you will see a message saying that the server is up and running. A lot of things are happening that are worth discussing in detail. We start by importing Flask and creating an <code>app</code>. Our app is very powerful; one of the things it allows us to do is to trigger specific functions when we head to specific locations on the server. These are called <code>routes</code>; when we define a route and we add the string <code>'/'</code> it means that the function following it will be triggered whenever someone enters to the root of the server (<code>/</code>). Our example only returns a message saying that everything went well.<p>The last line runs the app. This is an infinite loop that will open a port at localhost for us to test our application. If you are familiar with how PyQt works, you will notice the similarities. Once the app is running, you can point the browser to the address that appears on your command line, most likely <code>localhost:5000</code>. When you enter to that address, you are triggering the <code>route('/')</code> and therefore you will get the message <code>The Server is up and running</code>.<p>So far, both the server and the client are the same device. We will see later how to improve on this, but for the time being, you can believe that everything will work exactly the same, even when communicating through the network. It is possible to trigger other actions directly on the server side, not only to return strings. To test it, we can use a <code>print</code> statement. Let's re-write the <code>index()</code> function:<pre><code class=language-python>[...]

def index():
   print('Index Triggered')
   return 'The server is up, running, and printing statements'

[...]
</code></pre><p>If you run the server file again and head your browser to <code>localhost:5000</code> you should see not only the string appearing on your screen, but also a message will appear on the command line where the server is running. The <code>print</code> function is being triggered on the server. We could use more complex functions than <code>print</code>. For example, we could trigger a measurement on a device.<div class="admonition note"><p class=admonition-title>Note<p>If you are not dealing with instruments but you would like to trigger computer-intensive tasks on a remote computer, you can use the same approach explained here. You can then leverage computers with more memory or better processors, or you can even make a parallel execution of your code without leaving your Jupyter notebook.</div><p>Let's assume you have a device like the one we developed in our earlier post <a href=http://localhost:8000/blog/how-to-write-a-driver-with-lantz>How to Write a Driver with Lantz</a>. The device is an oscilloscope with several built-in methods, including <code>idn</code> for getting its serial number, and <code>datasource</code> to set and get the channel used for an acquisition. We would like to trigger some of those methods when we head to specific addresses on our browser. Later on, we will change the browser by a custom-made client that will simplify our workflow. We begin by initializing the device and we make it available to the app:<pre><code class=language-python>from flask import Flask
from devices import my_device

dev = my_device.via_usb()

app = Flask(__name__)

@app.route('/idn')
def idn():
   return dev.idn

app.run()
</code></pre><p>The core is the same as before, but we have added some lines for the device. We import the needed classes and we initialize the communication with the device; you should adapt the highlighted lines with your own device. The new route now establishes that if you head to <code>localhost:5000/idn</code>, the serial number of the device is going to be returned. This action is much more complex than printing on the server or returning a simple string. What we are actually sending is a command to a device, waiting for it to return a value and then we are sending it back to the browser. With this simple example, you can already see that we are doing virtually everything that a device can handle. Of course, devices also take inputs, and we should take into account this. Basing ourselves on the example of an <a href=http://localhost:8000/blog/how-to-write-a-driver-with-lantz>oscilloscope with Lantz</a>, we could change the datasource property of the device like this:<pre><code class=language-python>[...]
@app.route("/datasource/&LTint:source_id>")
def datasource(source_id):
   dev.datasource = source_id
   return(dev.datasource)
</code></pre><p>The lines above show a very simple way of sending variables through a browser. The <code>route</code> takes more complex structures than plain strings. <code>&LTint:source_id></code> will take an integer after the <code>datasource/</code> and it will pass it as an argument to the function below. The function <code>datasource</code> in our server, therefore, should take exactly one argument, <code>source_id</code>, and we use it for changing the <code>datasource</code> of the device. Now, if you head your browser to <code>localhost:5000/datasource/1</code> we will change the source to 1, we can do the same with 2, 3, etc. Bear in mind that not all values are valid with the device. Check what happens if, for example, you send a value outside the range of what is possible.<p>Communicating with our devices through the browser may not be the most practical approach. Instead, we can build a special program called Client that will handle the sending and retrieving of information from the server. When we have control on both the server and the client side software, we can easily control the data that is being exchanged. When we don't have control over one of the two sides, we have to base ourselves on available standards; for example, the data that a browser can handle is limited, the instructions a server can receive are few, etc. We are going to base our client on a common Python library called <code>requests</code>:<pre><code class=language-python>import requests

addr = 'http://localhost:5000'
r = requests.get(addr + "/idn")

print(r.content)
</code></pre><p>If you run the script written above (while the server script is running on a different command line), you will see that what gets printed on screen is the identification of the device. Basically, what you have achieved is the exchange of information from a device hooked to a server with a client not directly bound to that device. You could build a class around the requests. If you want, for example, a client exclusively for the oscilloscope, we can do the following:<pre><code class=language-python>import requests


def ClientOscilloscope():
   def __init__(self, addr):
      self.addr = addr

   def idn(self):
      r = requests.get(self.addr + '/idn')
      return r.content

if __name__ == '__main__':
   c = ClientOscilloscope('http://localhost:5000')
   print(c.idn())
</code></pre><p>The applications of this approach are multiple and not limited to communicating over the network. Imagine that you want to share the information of a device with multiple applications; instead of initializing the communication with the device in each application (that will almost certainly lead to issues), you can communicate through a server, even if on the same computer. You can test this idea if you access <code>localhost</code> from two different browsers. You can get the <code>idn</code> of your device twice without issues. You can also run the client script from two different command lines, and you will see that your server can handle several requests at the same time without issues and without blocking the device; the communication is initialized only once, at the beginning of the server script.<p>Being able to access the server from a different computer depends on the configuration of your network. First, you need to know the <code>ip</code> address of your computer. Remember that an ip is a unique number that identifies your connection to a network; if you are connected to the Internet, you will have two different numbers, the ip of your computer within a local network, and the public ip that is going to be shared by all the other computers on the same network.<p>Let's assume that you want to control a device within a local network in your lab. The only thing you need to do is to run the server on the computer you wish to use; most likely you are going to desire a specific port number for the inbound communication. You can do so with this simple command:<pre><code class=language-python>app.run('0.0.0.0', 1234)
</code></pre><p>which will allow you to run the server on port 1234. You have to check that the port is not used by other processes; for example, port 80 is used by HTTP connections. You can aim for higher numbers like 10000 and above, since those are most likely not used and open within your network. If you now head the browser of another device to <code>ip:1234/idn</code> you should see the identification number of your device. This procedure is mobile-friendly; you could use your phone to trigger measurements, without developing any apps, just using your mobile browser.<p>Accessing a computer from outside the local network is possible, but it normally depends on the policy of the institution where you work. The easiest way is to have port forwarding, for example when you access <code>public_ip:specific_port</code>, the connection is forwarded to a specific computer within the local network. To configure it, you need help from the administrator of the network and as a general safety rule, they will never allow such a thing. If you make a mistake, you are giving access to anyone who finds out which port to use.<p>The possibilities are limitless. If you want to see how to configure a more complex Server/Client strategy that handles any number of devices, you can check <a href=https://github.com/uetke/UUServer>Uetke's Instrument Server</a>. In this project, the server is an extension of Flask; we have defined some common routes to communicate with clients. We have also made use of <code>JSON</code> as a way of exchanging structured information between client and server. The repository also includes a client and a fake instrument to test the behavior.<p>The examples we have shown above are very basic but important to understand, if you want to achieve more complex functionality. For example, if you want the server to stay responsive while triggering tasks that take long to execute on a device, you have to implement threads. That is a more extensive discussion than what we can have here, but you can find an implementation example <a href=https://github.com/uetke/UUServer/blob/master/instserver/server.py>here</a>. There are some other packages that can be used for threading on web servers. Those packages were created precisely to handle async tasks. They are aimed at web development but could be useful also for applications with experiments. You can check for example, <a href=http://docs.celeryproject.org/en/latest/>Celery</a> and <a href=https://www.rabbitmq.com>RabbitMQ</a>, although they are fairly complex, they can be exactly what you are looking for.<p>If you need help developing a code for communicating over the network, don't hesitate to <a href=https://www.pythonforthelab.com/about>contact us</a>. We can custom build a solution to your problem. If you would like to learn about network communication and much more, you can also consider our <a href=https://www.pythonforthelab.com/hire-me>Advanced Python For The Lab Course</a>.<p>Header photo by <a href=https://unsplash.com/photos/l090uFWoPaI?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText>John Carlisle</a> on Unsplash</main><div class=info-list><span class="item author">Article written by Aquiles Carattino</span></div><div class=similar-posts><h3>Related Articles:</h3><ul><li><a class=item href=http://localhost:8000/blog/how-to-write-a-driver-with-lantz> <img alt src=/images/toolbox_linkedin.width-800.jpg> <span class=date>2018-02-23</span> <span class=name>How to Write a Driver with Lantz</span> </a><li><a class=item href=http://localhost:8000/blog/using-pyzmq-for-inter-process-communication-part-1> <img alt src=/images/thomas-jensen-592813-unsplash_linkedin.width-800.jpg> <span class=date>2018-12-17</span> <span class=name>Using pyZMQ for inter-process communication: Part 1</span> </a><li><a class=item href=http://localhost:8000/blog/using-pyzmq-for-inter-process-communication-part-2> <img alt src=/images/thomas-jensen-592813-unsplash_linkedin_elhzvKj.width-800.jpg> <span class=date>2019-03-05</span> <span class=name>Using pyZMQ for inter-process communication: Part 2</span> </a></ul></div><div class=bottom-section><h4>Share your thoughts with us!</h4><div class=comments><script async crossorigin issue-term=pathname label=Comment repo=PFTL/pftl_discussions src=https://utteranc.es/client.js theme=github-light></script></div></div></div><div class=rightside><div class=support-box><h3>Support Us</h3><p>If you like the content of this website, consider buying a copy of the book <strong>Python For The Lab</strong></p><a class=button href=http://localhost:8000/books>Check out the book</a></div><div class=latest-posts><h3>Latest Articles</h3><ul><li><a href=http://localhost:8000/blog/instructions-to-build-the-python-for-the-lab-daq/>Instructions to build the Python for the Lab DAQ.</a> <span>by Aquiles Carattino, 2021-03-27</span><li><a href=http://localhost:8000/blog/using-slots-in-python-limit-dynamic-attribute-creation-and-improve-speed>Using slots in Python: limit dynamic attribute creation and improve speed</a> <span>by Aquiles Carattino, 2021-03-21</span><li><a href=http://localhost:8000/blog/getting-started-with-basler-cameras>Acquiring images from Basler Cameras</a> <span>by Aquiles Carattino, 2021-02-27</span><li><a href=http://localhost:8000/blog/singletons-instantiate-objects-only-once>Singletons: Instantiate objects only once</a> <span>by Aquiles Carattino, 2021-01-16</span><li><a href=http://localhost:8000/blog/differences-between-multiprocessing-windows-and-linux>Differences of Multiprocessing on Windows and Linux</a> <span>by Aquiles Carattino, 2020-06-13</span><li><a href=http://localhost:8000/blog/python-tip-using-else-loops>Python Tip: Using Else with Loops</a> <span>by Aquiles Carattino, 2020-05-25</span><li><a href=http://localhost:8000/blog/python-tip-ready-publish-matplotlib-figures>Python Tip: Ready to Publish Matplotlib Figures</a> <span>by Aquiles Carattino, 2020-05-18</span><li><a href=http://localhost:8000/blog/data-descriptors-bringing-attributes-next-level>Data Descriptors: Bringing Attributes to the Next level</a> <span>by Aquiles Carattino, 2020-05-16</span><li><a href=http://localhost:8000/blog/python-tips-using-sets>Python Tips: Using Sets</a> <span>by Aquiles Carattino, 2020-05-11</span><li><a href=http://localhost:8000/blog/generators-iterables-iterators-python-when-and-where>Generators, Iterables, Iterators in Python: When and Where</a> <span>by Aquiles Carattino, 2020-04-10</span></ul></div><div class=subscribe-fixed><button class=action>Never Stop Learning</button><div class=cnt><p>Join over 1000 Python developers and don't miss any updates!<form action=https://pythonforthelab.us21.list-manage.com/subscribe/post?u=f0d9bfa6188cdcc67890a07f6&id=8a0ca536e8&f_id=00dfebe6f0 class=validate id=mc-embedded-subscribe-form method=post name=mc-embedded-subscribe-form novalidate><div class=field-wp id=mc_embed_signup><input class="field required email" placeholder="Your E-Mail" id=mce-EMAIL name=EMAIL required type=email></div><div class="clear foot" id=mce-responses><div class=response id=mce-error-response style=display:none></div><div class=response id=mce-success-response style=display:none></div></div><div aria-hidden=true style=position:absolute;left:-5000px>/* real people should not fill this in and expect good things - do not remove this or risk form bot signups */ <input name=b_f0d9bfa6188cdcc67890a07f6_8a0ca536e8 tabindex=-1></div><input value="Subscribe to the Newsletter" class=send-btn id=mc-embedded-subscribe name=subscribe type=submit></form><p>Or check out our <a href=/books>books</a>! <br> <a href=#>Privacy Policy</a></div></div></div></div><div class=mobile-sb-form><div class=sb-form><h4>Get all the information directly to your inbox</h4><form action=https://pythonforthelab.us21.list-manage.com/subscribe/post?u=f0d9bfa6188cdcc67890a07f6&id=8a0ca536e8&f_id=00dfebe6f0 class=validate id=mc-embedded-subscribe-form method=post name=mc-embedded-subscribe-form novalidate><div class=field-wp id=mc_embed_signup><input class="field required email" placeholder="Your E-Mail" id=mce-EMAIL name=EMAIL required type=email></div><div class="clear foot" id=mce-responses><div class=response id=mce-error-response style=display:none></div><div class=response id=mce-success-response style=display:none></div></div><div aria-hidden=true style=position:absolute;left:-5000px>/* real people should not fill this in and expect good things - do not remove this or risk form bot signups */ <input name=b_f0d9bfa6188cdcc67890a07f6_8a0ca536e8 tabindex=-1></div><input value="Subscribe to the Newsletter" class=send-btn id=mc-embedded-subscribe name=subscribe type=submit></form></div></div></div></div></section><div class=footer><div class=container><div class=footer-cnt><p class=left>© Python For The Lab <span class=current-year>2023</span><p class=center><a href=http://creativecommons.org/licenses/by-nc-sa/4.0/ rel=license> <img alt="Creative Commons License" src=https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png style=border:0></a>.<p class=right><a href=http://localhost:8000/cookie-policy>Cookie Policy</a> <a href=http://localhost:8000/privacy-policy>Privacy Policy</a></div></div></div><script src=http://localhost:8000/theme/js/prism.js></script><script src=https://files.stork-search.net/releases/v1.5.0/stork.js></script><script>stork.register("sitesearch","http://localhost:8000/search-index.st")</script>