<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CYPVPEJ4PK"></script>
  <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-CYPVPEJ4PK');

  </script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <title>How to use decorators Part 2 | Python For The Lab</title>

  <meta name="tags" content="Decorators, Tricks, Validation, Data, Intermediate, ">
  <meta name="description" content="Learn how to use decorators like a professional">
  <meta name="author" content="Aquiles Carattino">
  <link rel="canonical" href="blog/how-to-use-decorators-part-2">

  <!-- Open Graph / Facebook -->
  <meta property="og:site_name" content="Python for the Lab">
  <meta property="og:type" content="article">
  <meta property="og:url" content="blog/how-to-use-decorators-part-2">
  <meta property="og:title" content="How to use decorators Part 2">
  <meta property="og:description" content="Learn how to use decorators like a professional">
  <meta property="og:image" content="/images/michael-browning-227688-unsplash_linkedin.width-800.jpg">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="blog/how-to-use-decorators-part-2">
  <meta property="twitter:title" content="How to use decorators Part 2">
  <meta property="twitter:description" content="Learn how to use decorators like a professional">
  <meta property="twitter:image" content="/images/michael-browning-227688-unsplash_linkedin.width-800.jpg">
  <meta name="twitter:creator" content="@aquicarattino">

  <link rel="apple-touch-icon" sizes="57x57"
        href="https://pythonforthelab.com/theme/css/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60"
        href="https://pythonforthelab.com/theme/css/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72"
        href="https://pythonforthelab.com/theme/css/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76"
        href="https://pythonforthelab.com/theme/css/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114"
        href="https://pythonforthelab.com/theme/css/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120"
        href="https://pythonforthelab.com/theme/css/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144"
        href="https://pythonforthelab.com/theme/css/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152"
        href="https://pythonforthelab.com/theme/css/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180"
        href="https://pythonforthelab.com/theme/css/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"
        href="https://pythonforthelab.com/theme/css/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32"
        href="https://pythonforthelab.com/theme/css/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96"
        href="https://pythonforthelab.com/theme/css/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16"
        href="https://pythonforthelab.com/theme/css/favicon/favicon-16x16.png">
  <link rel="manifest" href="https://pythonforthelab.com/theme/css/favicon/manifest.json"/>
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="https://pythonforthelab.com/theme/css/favicon/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link
      href="https://fonts.googleapis.com/css2?family=Markazi+Text:wght@400;700&family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;700&display=swap"
      rel="stylesheet">

  <link rel="stylesheet" href="https://files.stork-search.net/basic.css"/>
  <link rel="stylesheet" href="https://pythonforthelab.com/theme/css/tw_style.css">
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://https://pythonforthelab.com/feed.rss">	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script type="text/javascript" src="https://pythonforthelab.com/theme/js/jquery-migrate-1.2.1.js"></script>

	<script src="https://pythonforthelab.com/theme/js/functions.js"></script>  <link rel="stylesheet" href="https://pythonforthelab.com/theme/css/prism.css"/>
</head>

<body class="text-gray-800">
  <header class="relative bg-gray-800 md:h-80 lg:flex h-64">
    <div class="lg:flex-col lg:lg:w-[880px] lg:ml-16">
      <nav class="lg:pr-8 w-full lg:pt-4">
        <div class="flex p-3 items-center justify-between">
          <a class="flex-none" href="https://pythonforthelab.com">
            <img id="site-logo" class="h-12"
                 src="https://pythonforthelab.com/theme/css/images/logo-red.svg"/>
          </a>
          <div id="menu_sm"
               class="pr-0 pl-4 grow hidden lg:block">
<ul
        class="w-full font-semibold text-3xl lg:flex lg:pl-16 lg:text-white md:text-base md:font-medium z-50">
    <li class="nav-item md:grow align-middle ">
        <a href="https://pythonforthelab.com/blog"
           class="md:pt-6 md:pb-2 hover:border-b-2 hover:border-red-400">
            <span class="">Blog</span>
        </a>
    </li>
    <li class="nav-item md:grow align-middle ">
        <a href="https://pythonforthelab.com/courses"
           class="md:pt-6 md:pb-2 hover:border-b-2 hover:border-red-400">
            <span class="">Courses</span>
        </a>
    </li>
    <li class="nav-item md:grow align-middle ">
        <a href="https://pythonforthelab.com/hire-me"
           class="md:pt-6 md:pb-2 hover:border-b-2 hover:border-red-400">
            <span class="">Hire Me</span>
        </a>
    </li>
    <li class="nav-item md:grow align-middle ">
        <a href="https://pythonforthelab.com/books"
           class="md:pt-6 md:pb-2 hover:border-b-2 hover:border-red-400">
            <span class="">Books</span>
        </a>
    </li>
    <li class="nav-item md:grow align-middle ">
        <a href="https://pythonforthelab.com/about"
           class="md:pt-6 md:pb-2 hover:border-b-2 hover:border-red-400">
            <span class="">About</span>
        </a>
    </li>
    <li class="nav-item md:grow align-middle ">
        <a href="https://github.com/PFTL/pftl_discussions/discussions"
           class="md:pt-6 md:pb-2 hover:border-b-2 hover:border-red-400">
            <span class="">Forum</span>
        </a>
    </li>
    <li class="pt-4 md:hidden">
        <form action="#" class="w-full pr-8">
            <label for="search" class="relative block">
                <img class="absolute w-4 h-4 top-1/2 -translate-y-1/2 left-3"
                     src="https://pythonforthelab.com/theme/css/images/search.svg">
                <input id="search" data-stork="sitesearch" type="text"
                       class="text-base placeholder-gray-500 pl-10 py-4 w-full shadow-sm ring-1 ring-inset ring-gray-300 focus:border-2 focus:border-red-500 focus:ring-red-500"
                       placeholder="Type to Search">
            </label>
        </form>
        <div data-stork="sitesearch-output"></div>
    </li>
</ul>          </div>
          <div class="">
            <button id="menu-button" class="z-50 border-1 border-red-500 lg:hidden">
              <img id="hamburger" src="https://pythonforthelab.com/theme/css/images/hamburger.svg"
                   class="h-8 w-8"/>
            </button>
          </div>
        </div>
        <div id="menu"
             class="pr-0 pb-8 mx-0 pt-8 pl-12 basis-full grow bg-white z-30 min-w-full hidden drop-shadow-lg border-b-8 border-b-red-700">
<ul
        class="w-full font-semibold text-3xl md:grid md:grid-cols-6 md:px-16 md:text-base md:font-medium">
    <li class="nav-item align-middle md:h-16 md:pl-8  md:shadow-xl md:hover:shadow-2xl md:active:shadow-none">
        <a href="https://pythonforthelab.com/blog"
           class="before:content-blogIcon
            before:inline-block before:align-middle before:h-6 before:w-6 md:py-6 md:pr-12
            before:md:h-8 before:md:w-8">
            <span class="">Blog</span>
        </a>
    </li>
    <li class="nav-item align-middle md:h-16 md:pl-8  md:shadow-xl md:hover:shadow-2xl md:active:shadow-none">
        <a href="https://pythonforthelab.com/courses"
           class="before:content-coursesIcon md:w-full
            before:inline-block before:align-middle before:h-6 before:w-6 md:py-6 md:pr-12
            before:md:h-8 before:md:w-8">
            <span class="">Courses</span>
        </a>
    </li>
    <li class="nav-item align-middle md:h-16 md:pl-8  md:shadow-xl md:hover:shadow-2xl md:active:shadow-none">
        <a href="https://pythonforthelab.com/hire-me"
           class="before:content-hireIcon
            before:inline-block before:align-middle before:h-6 before:w-6 md:py-6 md:pr-12
            before:md:h-8 before:md:w-8">
            <span class="">Hire Me</span>
        </a>
    </li>
    <li class="nav-item align-middle md:h-16 md:pl-8  md:shadow-xl md:hover:shadow-2xl md:active:shadow-none">
        <a href="https://pythonforthelab.com/books"
           class="before:content-booksIcon
            before:inline-block before:align-middle before:h-6 before:w-6 md:py-6 md:pr-12
            before:md:h-8 before:md:w-8">
            <span class="">Books</span>
        </a>
    </li>
    <li class="nav-item align-middle md:h-16 md:pl-8  md:shadow-xl md:hover:shadow-2xl md:active:shadow-none">
        <a href="https://pythonforthelab.com/about"
           class="before:content-aboutIcon
            before:inline-block before:align-middle before:h-6 before:w-6 md:py-6 md:pr-12
            before:md:h-8 before:md:w-8">
            <span class="">About</span>
        </a>
    </li>
    <li class="nav-item align-middle md:h-16 md:pl-8  md:shadow-xl md:hover:shadow-2xl md:active:shadow-none">
        <a href="https://github.com/PFTL/pftl_discussions/discussions"
           class="before:content-forumIcon
            before:inline-block before:align-middle before:h-6 before:w-6 md:py-6 md:pr-12
            before:md:h-8 before:md:w-8">
            <span class="">Forum</span>
        </a>
    </li>
    <li class="pt-4 md:hidden">
        <form action="#" class="w-full pr-8">
            <label for="search" class="relative block">
                <img class="absolute w-4 h-4 top-1/2 -translate-y-1/2 left-3"
                     src="https://pythonforthelab.com/theme/css/images/search.svg">
                <input id="search" data-stork="sitesearch" type="text"
                       class="text-base placeholder-gray-500 pl-10 py-4 w-full shadow-sm ring-1 ring-inset ring-gray-300 focus:border-2 focus:border-red-500 focus:ring-red-500"
                       placeholder="Type to Search">
            </label>
        </form>
        <div data-stork="sitesearch-output"></div>
    </li>
</ul>        </div>
      </nav>
      <div class="md:flex text-gray-200 lg:min-w-full lg:pt-4 pb-8">
      </div>
    </div>
    <div class="hidden lg:block lg:w-72 ml-1 pl-2 mr-2 pt-4 w-72">
      <div class="mb-8 shadow-2xl">
        <form action="#" class="w-full pr-8 pt-4 text-xs">
          <label for="search" class="relative block">
            <img class="absolute w-4 h-4 top-1/2 -translate-y-1/2 left-3"
                 src="https://pythonforthelab.com/theme/css/images/search.svg">
            <input id="search" data-stork="sitesearch" type="text"
                   class="text-gray-800 pl-10 bg-white py-2 placeholder-gray-500 w-full border border-gray-600"
                   placeholder="Type to Search">
          </label>
        </form>
        <div data-stork="sitesearch-output"></div>
      </div>
      <div class="py-2 shadow-2xl">
        <div class="text-gray-300">
          <span class="font-semibold text-sm">Get all the information directly to your inbox.</span>
        </div>
        <div id="mc_embed_signup" class="">
          <form
              action="https://pythonforthelab.us21.list-manage.com/subscribe/post?u=f0d9bfa6188cdcc67890a07f6&amp;id=8a0ca536e8&amp;f_id=00dfebe6f0"
              method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form"
              class="validate my-3 md:max-w-lg"
              target="_self" novalidate="">
            <div class="field-wp">
              <input type="email" name="EMAIL" placeholder="Your E-Mail" id="mce-EMAIL" required=""
                     value=""
                     class="required email bg-white ring-red-500 p-2 w-full md:max-w-2/3">
            </div>
            <div id="mce-responses" class="clear foot">
              <div class="response" id="mce-error-response" style="display: none;"></div>
              <div class="response" id="mce-success-response" style="display: none;"></div>
            </div>
            <div style="position: absolute; left: -5000px;" aria-hidden="true">
              /* real people should not fill this in and expect good things - do not remove this or risk
              form
              bot
              signups */
              <input type="text" name="b_f0d9bfa6188cdcc67890a07f6_8a0ca536e8" tabindex="-1" value="">
            </div>
            <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"
                   class="bg-emerald-500 hover:scale-105 focus:bg-emerald-300 text-white p-4 mt-2 w-full md:max-w-2/3">
          </form>
          <span class="text-gray-400 text-xs">Unsubscribe any time.</span>
        </div>
      </div>
    </div>
  </header>

  <div class="lg:mx-auto lg:flex lg:ml-16">

    <div id="col-left" class="md:content-stretch lg:w-[880px]">
      <div class="relative text-gray-800 mx-2 z-40">
        <div class="md:-mt-32 lg:-mt-56 -mt-36 lg:mb-8">
          <img src="/images/michael-browning-227688-unsplash_linkedin.width-800.jpg" alt="How to use decorators Part 2" class="shadow-md lg:shadow-lg"/>
        </div>
        <h1 class="font-serif font-extrabold text-4xl leading-tight pb-2">How to use decorators Part 2</h1>
        <div class="font-sans font-bold text-xl">Learn how to use decorators like a professional</div>
        <div class="text-sm text-gray-400">
          <span
              class="inline-block before:inline-block before:mx-1 before:align-middle before:h-4 before:w-4 before:content-profile mr-1 pr-1 py-1">Aquiles Carattino</span>
          <span
              class="inline-block before:inline-block before:mx-1 before:align-middle before:h-4 before:w-4 before:content-calendar mr-1 pr-1 py-1">2018-05-18</span>
          <span
              class="inline-block before:inline-block before:mx-1 before:align-middle before:h-4 before:w-4 before:content-tag mr-1 pr-1 py-1">
              <span class="bg-gray-300 rounded text-white px-0.5 mr-0.5 ">Decorators</span>
              <span class="bg-gray-300 rounded text-white px-0.5 mr-0.5 ">Tricks</span>
              <span class="bg-gray-300 rounded text-white px-0.5 mr-0.5 ">Validation</span>
              <span class="bg-gray-300 rounded text-white px-0.5 mr-0.5 ">Data</span>
              <span class="bg-gray-300 rounded text-white px-0.5 mr-0.5 ">Intermediate</span>
        </span>
        </div>
      </div>

      <div class="article-content mt-4 mx-2">
        <main>
          <p>Decorators are a very useful programming pattern that allows changing
the behavior of functions with little refactoring. Decorators allow
developers to abstract common options from functions, but mastering
their use in Python can be challenging. In this article, we are going to
go in depth regarding different options when implementing decorators.
The topics covered are:</p>
<p>In a <a href="https://pythonforthelab.com/blog/how-to-use-decorators-to-validate-input">previous article on the use of decorators to validate user
input</a>, we have seen just
the very beginning of what decorators are able to provide to the
developer. Let's first recap what we saw earlier. We can define a
decorator as a function that will take as input another function. We can
use it to check the input of the latter, for example:</p>
<pre><code class="language-python">def check_positive(func):
    def func_wrapper(x, y):
        if x&lt;0 or y&lt;0:
            raise Exception(&quot;Both x and y have to be positive \
            for function {} to work&quot;.format(func.__name__))
        res = func(x,y)
        return res
    return func_wrapper
</code></pre>
<p>The function <code>check_positive</code> checks that the inputs of a function are
all positive before actually calling the function. To use it, we would
do something like this:</p>
<pre><code class="language-python">@check_positive
def average(x, y):
    return (x + y)/2

a = average(1,2)
print(a)
b = average(1, -1)
print(b)
</code></pre>
<p>In the first case, the function would work, giving as output <code>1.5</code>,
while in the second case it would raise an exception because one of the
arguments is not positive. If you can't understand the code above, you
should check the <a href="https://pythonforthelab.com/blog/how-to-use-decorators-to-validate-input">first article published on
decorators</a>.</p>
<h2>Docstrings with decorators</h2>
<p>This example works fine, but it already shows an issue that for larger
projects is very relevant: docstrings, i.e. the documentation of
functions, methods, and classes, stop working when using decorators like
above. Let's add documentation to the function <code>average</code>, like this:</p>
<pre><code class="language-python">def average(x, y):
    &quot;&quot;&quot;Calculates the average between two numbers.&quot;&quot;&quot;
    return (x + y)/2
</code></pre>
<p>The string right after the definition of the function and starting with
the triple quotes <code>"""</code> is used for building the documentation of
projects and is also used with the <code>help</code> command:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; help(average)
average(x, y)
    Calculates the average between two numbers.
</code></pre>
<p>This is very useful when working with libraries developed by others. It
also allows you to build documentation, such as the one you find for
<a href="https://docs.scipy.org/doc/numpy-1.14.2/user/quickstart.html">numpy</a>,
but we will cover this in a later tutorial. However, if we use a
decorator, the behavior changes:</p>
<pre><code class="language-python">@check_positive
def average(x, y):
    [...]
</code></pre>
<p>The <code>[...]</code> means that there is code being suppressed for brevity. If
again we try to get the help of our function:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; help(average)
func_wrapper(x, y)
</code></pre>
<p>As you can see, the docstring of the function <code>average</code> was replaced by
the docstring of the wrapper, which in the example above is empty. What
we can do to avoid this problem is to pass the docstring and the name of
the function to the name and docstring of the decorator. Like this:</p>
<pre><code class="language-python">def check_positive(func):
    def func_wrapper(x, y):
        if x &lt; 0 or y &lt; 0:
            raise Exception(&quot;Both x and y have to be positive for function {} to work&quot;.format(func.__name__))
        res = func(x, y)
        return res
    func_wrapper.__name__ = func.__name__
    func_wrapper.__doc__ = func.__doc__
    return func_wrapper
</code></pre>
<p>And if we repeat the steps above, we see that the help command is giving
the expected output. We can also add a docstring to the decorator:</p>
<pre><code class="language-python">def check_positive(func):
    &quot;&quot;&quot;Decorator to check that the inputs of a function are positive&quot;&quot;&quot;
    [...]
</code></pre>
<p>As with many things in Python, this is not the only option but is the
one that allows you to see how some of the internals work, such as the
<code>__name__</code> and <code>__doc__</code> properties. Another option is to use a built-in
decorator from Python that would allow you to do exactly what we have
done but in one single line:</p>
<pre><code class="language-python">from functools import wraps

def check_positive(func):
    @wraps(func)
    def func_wrapper(x, y):
        if x &lt; 0 or y &lt; 0:
            raise Exception(&quot;Both x and y have to be positive for function {} to work&quot;.format(func.__name__))
        res = func(x, y)
        return res
    return func_wrapper
</code></pre>
<p>The highlighted lines are the ones that changed compared to the previous
example. Again, the <code>help</code> command is working as expected. In principle
what the decorator <code>@wraps</code> does is the same as setting the <code>__name__</code>
and <code>__doc__</code> properties. Now you start seeing that the uses of
decorators are virtually endless.</p>
<h2>Arguments in decorators</h2>
<p>Imagine that you want to be able to check that both arguments in a
function are higher than a parameter, not necessarily <code>0</code>. This would
imply that the decorator takes one argument. Let's see first what do we
want to achieve and then how to do it.</p>
<pre><code class="language-python">@check_above(2)
def average(x, y):
    return (x + y)/2
</code></pre>
<p>We expect the function <code>average</code> to work only if both <code>x</code> and <code>y</code> are
larger than 2. This is very useful when you are communicating with a
device, for example, and you want to be sure that you are passing values
which are allowed. However, the decorator that we defined earlier takes
as an argument only the function to be decorated and it will fail if we
add anything else. Solving this is a bit more involved because it
requires a function that returns a decorator. We can do the following:</p>
<pre><code class="language-python">def check_above(threshold):
    def wrap(func):
        @wraps(func)
        def func_wrapper(x, y):
            if x &lt; threshold or y &lt; threshold:
                raise Exception(&quot;Both x and y have to be larger than {} \
                for function {} to work&quot;.format(threshold, func.__name__))
            res = func(x, y)
            return res
        return func_wrapper
    return wrap
</code></pre>
<p>Let's see step by step what is going on. The function <code>check_above</code>
returns the decorator called <code>wrap</code>. Therefore, technically, the
function will be decorated with <code>wrap</code> and not with <code>check_above</code>, but
now we can use the parameter <code>threshold</code>. We have translated everything
one layer deeper, but the behavior is essentially the same. Note that
now you check that both <code>x</code> and <code>y</code> are above the <code>threshold</code>. If you
try to calculate the average like this:</p>
<pre><code class="language-python">average(1, 2)
</code></pre>
<p>it will raise the exception because one of the values is not above the
specified threshold.</p>
<h2>When are decorators executed</h2>
<p>There is something very important to note: both decorators defined
earlier, <code>check_positive</code> and <code>check_above</code> are actually executed right
when defining the <code>average</code> function. You can test it by adding a
<code>print</code> statement, like this:</p>
<pre><code class="language-python">def check_positive(func):
    print('Checking if it is positive')
    @wraps(func)
    def func_wrapper(x, y):
        if x &lt; 0 or y &lt; 0:
            raise Exception(&quot;Both x and y have to be positive \
            for function {} to work&quot;.format(func.__name__))
        res = func(x, y)
        return res

    return func_wrapper
</code></pre>
<p>Whenever you import the module that contains the <code>average</code> function, you
will see:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; from utils import average
Checking if it is positive
</code></pre>
<p>This behavior may not be completely expected nor desired. For example,
imagine that you use a decorator that checks the status of a device
before allowing the user to send a new command to it. If you place the
verification routine outside of the function wrapper, it will be
triggered when you import the function and not when you execute it. This
can give rise to a lot of undesired errors because it is understandable
that a user is importing the needed functions first and then starting
the communication with a device.</p>
<p>On the other hand, being able to run code before the function is
executed, opens different doors. For example, you could register all the
available functions. Check the following example:</p>
<pre><code class="language-python"># utils.py
from functools import wraps

func_registry = []

def register(func):
    func_registry.append(func.__name__)
    @wraps(func)
    def func_wrapper(*args):
        return func(*args)
    return func_wrapper

@register
def average(x, y):
    return (x + y)/2

@register
def geom_average(x, y):
    return (x*y)**0.5
</code></pre>
<p>Now you can use it in the following way:</p>
<pre><code class="language-python">&gt;&gt;&gt; from utils import average
&gt;&gt;&gt; average(1, 2)
1.5
&gt;&gt;&gt; from utils import func_registry
&gt;&gt;&gt; for f in func_registry:
...     print(f)
...
average
geom_average
</code></pre>
<p>With this simple code, you already see that not only <code>average</code>, but also
<code>geom_average</code> is decorated with <code>@register</code>. This is very useful if,
for example, you want to have a list of a specific set of functions.
Imagine that you are developing a driver for a device, and some of the
methods are equivalent to buttons, i.e., you trigger an action by
pressing it, but no input is required and no output is generated.
<em>Switch on</em>, <em>Switch off</em>, <em>Auto calibrate</em>, etc. It would be handy to
have a list of all these methods, in order to display them to an
end-user, for example.</p>
<p>When you start designing decorators, especially if you are planning to
have other developers to use them, you have to be aware that some
behaviors are not always obvious to everybody. Documenting is crucial to
have reliable and maintainable libraries. Mixing the execution of code
with the definition of a function may give a lot of headaches to novice
developers and may become a nightmare to debug later on.</p>
<h2>Decorators for methods in classes</h2>
<p>So far we have covered how to use decorators for functions, but more
often than not you will find yourself using decorators for methods in
classes. For example, you would like to use the <code>check_positive</code> like
this:</p>
<pre><code class="language-python"># operations.py
class Operations:
    @check_positive
    def average(self, x, y):
        return (x + y)/2
</code></pre>
<p>I know that a class like that makes no sense at all, but it is only an
example, so please bear with me. If you want to use this class, you will
face an error:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; from operations import Operations
[...]
TypeError: func_wrapper() takes 2 positional arguments but 3 were given
</code></pre>
<p>When we defined the <code>check_positive</code> decorator, we explicitly used two
arguments for the <code>func_wrapper</code>, <code>x</code> and <code>y</code>. However, when we work
with methods, there will be one more argument, the <code>self</code>. There are
different ways of solving this problem. On one hand, you could adapt the
decorator in order to accommodate for the extra input, but then the
decorator will stop working with normal functions. Of course, you could
define a new decorator just for methods, but you would end up
duplicating the code, and you should try to avoid that.</p>
<p>One more general solution would be to use a variable number of arguments
for the decorator. This would be the idea:</p>
<pre><code class="language-python">from functools import wraps

def check_positive(func):
    @wraps(func)
    def func_wrapper(*args):
        for arg in args:
            if type(arg) is int or type(arg) is float:
                if arg &lt; 0:
                    raise Exception(&quot;Method {} takes only positive arguments&quot;.format(func.__name__))
        return func(*args)

    return func_wrapper
</code></pre>
<p>Now you can see that the decorator became more complex than before.
First, the <code>func_wrapper</code> takes <code>*args</code> as the argument, and no longer
explicitly <code>x</code> and <code>y</code>. The <code>*args</code> parameter is a good subject for a
next tutorial, what you should understand by now is that it makes a list
out of all the inputs of the function, regardless of how many they are.
This is what allows us to iterate through them by doing
<code>for arg in args</code>.</p>
<p>For every argument in the function, we have to check whether they are
numbers or not, i.e., if the <code>type</code> is either <code>int</code> or <code>float</code>. This
prevents us from checking if <code>self</code> is positive or not, which would
raise an exception. If the checks pass, we just return the original
function <code>func</code> with the same arguments <code>*args</code> which were originally
used. You can go ahead and try this decorator with either a method ìn
the <code>Operations</code> class or with a function. Moreover, you can now try it
with a function that takes three numbers as input and it will still
work.</p>
<h2>Classes as decorators</h2>
<p>So far, we have seen that you can use a function to decorate another
function or method. However, that is not the only option. Classes can be
used as decorators as well, and this opens an entire realm of
possibilities. What we have seen so far is that when you add a callable
with a <code>@</code> just before another callable (i.e. a method or a function in
our context), that function will be passed as an argument to the
decorator. When constructing classes, you can also pass functions as
arguments. For example:</p>
<pre><code class="language-python">class Decorator:
    def __init__(self, func):
        print('Decorating {}'.format(func.__name__))
        self.func = func

@Decorator
def average(x, y):
    return (x + y)/2
</code></pre>
<p>If you execute the code above you will see:</p>
<pre><code class="language-pycon">Decorating average
</code></pre>
<p>However, if you try to use the average, you will see an error:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; average(1, 2)
[...]
TypeError: 'Decorator' object is not callable
</code></pre>
<p>This is actually expected. What is happening is that the function
<code>average</code> is actually being turned into a <code>Decorator</code> class. The code
would be equivalent to doing something like this:</p>
<pre><code class="language-python">average = Decorator(average)
</code></pre>
<p>However, after the class has been instantiated, Python doesn't know what
does it mean to execute it. We need to explicitly add this behavior:</p>
<pre><code class="language-python">class Decorator:
    def __init__(self, func):
        print('Decorating {}'.format(func.__name__))
        self.func = func

    def __call__(self, *args, **kwargs):
        return self.func(*args)
</code></pre>
<p>With this change, we have instructed Python what does it means to <em>call</em>
the object, i.e., to do <code>average(...)</code>. If we run it again, it will
work:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; averge(1, 2)
1.5
</code></pre>
<p>Remember that, just as before, the instantiation of the <code>Decorator</code>
class is happening when defining the <code>average</code>, and therefore you will
see the line <code>Decorating average</code> when you <code>import average</code>. On the
other hand, you have transformed your function into a class:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; type(average)
&lt;class '__main__.Decorator'&gt;
</code></pre>
<p>How you can leverage the possibilities of using a class instead of a
function for decorating depends on the work you are trying to achieve.
Remember that the main use of classes is when you need to preserve
state. For example, imagine you would like to store every pair of values
on which you have calculated the average. You can easily turn this idea
into a cache system, avoiding to repeat processes for known arguments.</p>
<h2>Decorators for classes</h2>
<p>We have seen that any callable can be a decorator of any other callable.
That is why a function can be a decorator of another function or method.
Also, because a class is a callable, it can be a decorator of a function
or method. The last missing combination is to decorate classes. With
what you know so far, you can already anticipate what is going to
happen. Imagine you want to do this:</p>
<pre><code class="language-python">@Decorate
class MyClass:
    def __init__(self):
        print('My Class')
</code></pre>
<p>What you have to remember is that <code>Decorate</code> needs to accept <code>MyClass</code>
as input. Moreover, we need to actually instantiate the class when we
do:</p>
<pre><code class="language-python">my_class = MyClass()
</code></pre>
<p>Putting all the ideas together, the decorator will look like this:</p>
<pre><code class="language-python">def Decorate(cls):
    print('Decorating {}'.format(cls.__name__))
    def class_wrapper(*args):
        return cls(*args)
    return class_wrapper
</code></pre>
<p>What will happen is that the class will be passed as the argument of
<code>Decorate</code>. We will print that we are decorating the class, just to show
that it is actually working. The <code>Decorate</code> function needs to return
another callable object, in the example above is a function called
<code>class_wrapper</code>. This function will be responsible for instantiating the
class. Remember that when you use decorators, you are actually replacing
what happens when you do <code>MyClass()</code> by what happens when you do
<code>class_wrapper()</code>. Therefore, if you decorate the class, you will see
that its type changed:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; type(MyClass)
&lt;class 'function'&gt;
</code></pre>
<p>The main point here is that the function will return an object. This
allows you to instantiate the class as always, regardless of it having
or not the decorator:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; my_class = MyClass()
My Class
</code></pre>
<p>Decorating classes is a bit of a corner situation. To be honest, I don't
imagine a lot of scenarios where you would like to decorate a class, but
still, I will give you an example. Imagine that you want to add a new
method to every decorated class. A method that will calculate the
average between two numbers. What you have to do is to alter the <code>cls</code>
variable within the <code>class_wrapper</code>:</p>
<pre><code class="language-python">def Decorate(cls):
    def class_wrapper(*args):
        def average(cls, x, y):
            return (x + y) / 2
        setattr(cls, 'average', average)
        return cls(*args)
return class_wrapper
</code></pre>
<p>We have defined the function <code>average</code> that takes three arguments: a
class and two numbers. And then we use <code>setattr</code> to add the method to
<code>cls</code> and we call it <code>'average'</code>. Now, <code>MyClass</code> will be able to
calculate the average of numbers even if the method was not defined in
it:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; my_class = MyClass()
&gt;&gt;&gt; res = my_class.average(1, 2)
&gt;&gt;&gt; print(res)
1.5
</code></pre>
<h2>Conclusions</h2>
<p>In this tutorial, we have covered a lot of different options when
working with decorators. Depending on the kind of projects you are
working on, you may not find yourself in the situation of needing to
develop decorators, however, it is always useful to be aware of one
extra possibility. Decorators are very useful tools when a library is
going to be used by other developers.</p>
<p>Two libraries that make heavy use of decorators are
<a href="http://flask.pocoo.org/">Flask</a> and
<a href="https://github.com/lantzproject/">Lantz</a>. Therefore, even if you don't
develop your own decorators, it is always important to understand how
they work.</p>
        </main>
      </div>
      <div class="flex border-t text-lg px-4 pt-6 lg:pt-12 lg:mb-12">
        <div
            class="before:inset-y-1/2 before:inset-x-1 before:content-article before:h-6 before:w-6 before:inline-block before:align-middle"></div>
        <div class="pl-8 text-gray-600 font-light">Article written by Aquiles Carattino</div>
      </div>

      <div class="pt-4 pb-6 md:px-4 border-t border-gray-200 justify-center">
        <div class="bg-gray-300 font-serif text-2xl md:text-4xl text-center md:p-6 p-2">Join our newsletter!</div>
        <div class="py-4">If you liked the content, sign up to never miss an update.
        </div>
        <div id="mc_embed_signup" class="">
          <form
              action="https://pythonforthelab.us21.list-manage.com/subscribe/post?u=f0d9bfa6188cdcc67890a07f6&amp;id=8a0ca536e8&amp;f_id=00dfebe6f0"
              method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form"
              class="validate my-3 md:flex md:max-w-lg"
              target="_self" novalidate="">
            <div class="field-wp">
              <input type="email" name="EMAIL" placeholder="Your E-Mail" id="mce-EMAIL" required=""
                     value=""
                     class="required email bg-gray-100 ring-red-500 p-4 w-full md:max-w-2/3">
            </div>
            <div id="mce-responses" class="clear foot">
              <div class="response" id="mce-error-response" style="display: none;"></div>
              <div class="response" id="mce-success-response" style="display: none;"></div>
            </div>
            <div style="position: absolute; left: -5000px;" aria-hidden="true">
              /* real people should not fill this in and expect good things - do not remove this or risk
              form
              bot
              signups */
              <input type="text" name="b_f0d9bfa6188cdcc67890a07f6_8a0ca536e8" tabindex="-1" value="">
            </div>
            <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"
                   class="bg-emerald-500 hover:scale-105 w-full focus:bg-emerald-300 text-white p-4 mt-2 md:ml-4 md:mt-0 md:w-40">
          </form>
        </div>
      </div>

        <div class="lg:mt-6">
          <h2 class="font-serif font-semibold text-2xl leading-tight">Related Articles</h2>
          <div>
              <div class="group border-b border-b-gray-400 mb-4">
                <a href="blog/how-to-use-decorators-to-validate-input" class="text-gray-700 hover:text-gray-900">
                  <div class="sm:flex">
                    <div class="flex-none sm:w-64 md:w-96">
                      <img class="px-2 pb-4" src="/images/cartoon_decorators.png"
                           alt="Illustration of How to Use Decorators to Validate Input">
                    </div>
                    <div class="px-4 sm:flex-auto">
                      <div class="text-gray-600 text-xs p-0.5">2018-03-12</div>
                      <h3 class="font-serif leading-tight text-lg font-semibold pb-2">How to Use Decorators to Validate Input</h3>
                      <div class="font-sans ">Python is rich in resources that can shorten the time it takes to develop new programs and simplify repetitive tasks. Decorators are one of such elements but more often than not they are not considered by less experienced developers. Adding decorators to the syntactic toolbox can be of great use …</div>
                      <div class="p-2 inline-block font-sm"><span
                          class="after:transition-all after:ease-in-out hover:after:translate-x-2.5 after:inline-block after:translate-x-1.5 after:w-5 group-hover:after:content-arrowBlue">Read more</span>
                      </div>
                    </div>
                  </div>
                </a>
              </div>
              <div class="group border-b border-b-gray-400 mb-4">
                <a href="blog/mutable-and-immutable-objects" class="text-gray-700 hover:text-gray-900">
                  <div class="sm:flex">
                    <div class="flex-none sm:w-64 md:w-96">
                      <img class="px-2 pb-4" src="/images/rawpixel-274862-unsplash_linkedin.width-800.jpg"
                           alt="Illustration of Mutable and Immutable Objects">
                    </div>
                    <div class="px-4 sm:flex-auto">
                      <div class="text-gray-600 text-xs p-0.5">2018-08-23</div>
                      <h3 class="font-serif leading-tight text-lg font-semibold pb-2">Mutable and Immutable Objects</h3>
                      <div class="font-sans ">People who start programming in Python quickly stumble upon the existence of lists and tuples. They are defined in a similar way, they look the same. Sometimes they are even used interchangeably. The obvious question is, therefore, why do you have two different types of elements for the same goal …</div>
                      <div class="p-2 inline-block font-sm"><span
                          class="after:transition-all after:ease-in-out hover:after:translate-x-2.5 after:inline-block after:translate-x-1.5 after:w-5 group-hover:after:content-arrowBlue">Read more</span>
                      </div>
                    </div>
                  </div>
                </a>
              </div>
              <div class="group border-b border-b-gray-400 mb-4">
                <a href="blog/mutable-and-immutable-attributes-of-classes" class="text-gray-700 hover:text-gray-900">
                  <div class="sm:flex">
                    <div class="flex-none sm:w-64 md:w-96">
                      <img class="px-2 pb-4" src="/images/dan-gold-382057-unsplash_linkedin.width-800.jpg"
                           alt="Illustration of Mutable and Immutable Attributes of Classes">
                    </div>
                    <div class="px-4 sm:flex-auto">
                      <div class="text-gray-600 text-xs p-0.5">2018-08-24</div>
                      <h3 class="font-serif leading-tight text-lg font-semibold pb-2">Mutable and Immutable Attributes of Classes</h3>
                      <div class="font-sans ">We have seen how to leverage the differences between mutable and immutable objects and what happens when you use mutable types as default function arguments. However, we haven't discussed what happens when you use mutable types as default attributes of classes. Default values for attributes can be defined in different …</div>
                      <div class="p-2 inline-block font-sm"><span
                          class="after:transition-all after:ease-in-out hover:after:translate-x-2.5 after:inline-block after:translate-x-1.5 after:w-5 group-hover:after:content-arrowBlue">Read more</span>
                      </div>
                    </div>
                  </div>
                </a>
              </div>
          </div>
        </div>
      <div class="px-2 lg:text-center lg:mt-8">
        <h4 class="text-2xl leading-tight lg:mx-auto lg:text-4xl">Share your thoughts with us!</h4>
        <div class="comments">
          <!-- Comment -->
          <script src="https://utteranc.es/client.js"
                  repo="PFTL/pftl_discussions"
                  issue-term="pathname"
                  label="Comment"
                  theme="github-light"
                  crossorigin="anonymous"
                  async>
          </script>
        </div>
      </div>
    </div>
    <div id="col-right" class="lg:w-72">
      <div class="bg-gray-300 place-items-center mt-3 p-6">
        <h3 class="font-serif text-2xl text-center mb-2 font-semibold mx-auto lg:text-xl">Support Us</h3>
        <p class="font-serif lg:text-sm leading-tight mb-2">If you like the content of this website, consider buying a
          copy of
          the book
          <strong>Python For The
            Lab</strong></p>
        <a href="https://pythonforthelab.com/books">
          <button class="bg-emerald-500 hover:scale-105 focus:bg-emerald-300 text-white p-4 mt-2 w-full md:max-w-2/3">
            Check out the books
          </button>
        </a>
      </div>

      <div class="mt-3 border border-gray-400  place-items-center">
          <h3 class="bg-gray-300 font-serif text-2xl lg:text-xl lg:font-bold text-center py-4">Latest Articles</h3>
          <ul class="mt-4">
              <li class="mx-4 p-3 border-b border-b-gray-400">
                <a href="https://pythonforthelab.com/blog/instructions-to-build-the-python-for-the-lab-daq/" class="font-lg leading-tight hover:font-bold">
                  <div>Instructions to build the Python for the Lab DAQ.</div>
                  <div class="font-light text-gray-600 text-sm">
                    by Aquiles Carattino, 2021-03-27</div>
                </a>
              </li>
              <li class="mx-4 p-3 border-b border-b-gray-400">
                <a href="https://pythonforthelab.com/blog/using-slots-in-python-limit-dynamic-attribute-creation-and-improve-speed" class="font-lg leading-tight hover:font-bold">
                  <div>Using slots in Python: limit dynamic attribute creation and improve speed</div>
                  <div class="font-light text-gray-600 text-sm">
                    by Aquiles Carattino, 2021-03-21</div>
                </a>
              </li>
              <li class="mx-4 p-3 border-b border-b-gray-400">
                <a href="https://pythonforthelab.com/blog/getting-started-with-basler-cameras" class="font-lg leading-tight hover:font-bold">
                  <div>Acquiring images from Basler Cameras</div>
                  <div class="font-light text-gray-600 text-sm">
                    by Aquiles Carattino, 2021-02-27</div>
                </a>
              </li>
              <li class="mx-4 p-3 border-b border-b-gray-400">
                <a href="https://pythonforthelab.com/blog/singletons-instantiate-objects-only-once" class="font-lg leading-tight hover:font-bold">
                  <div>Singletons: Instantiate objects only once</div>
                  <div class="font-light text-gray-600 text-sm">
                    by Aquiles Carattino, 2021-01-16</div>
                </a>
              </li>
              <li class="mx-4 p-3 border-b border-b-gray-400">
                <a href="https://pythonforthelab.com/blog/differences-between-multiprocessing-windows-and-linux" class="font-lg leading-tight hover:font-bold">
                  <div>Differences of Multiprocessing on Windows and Linux</div>
                  <div class="font-light text-gray-600 text-sm">
                    by Aquiles Carattino, 2020-06-13</div>
                </a>
              </li>
              <li class="mx-4 p-3 border-b border-b-gray-400">
                <a href="https://pythonforthelab.com/blog/python-tip-using-else-loops" class="font-lg leading-tight hover:font-bold">
                  <div>Python Tip: Using Else with Loops</div>
                  <div class="font-light text-gray-600 text-sm">
                    by Aquiles Carattino, 2020-05-25</div>
                </a>
              </li>
              <li class="mx-4 p-3 border-b border-b-gray-400">
                <a href="https://pythonforthelab.com/blog/python-tip-ready-publish-matplotlib-figures" class="font-lg leading-tight hover:font-bold">
                  <div>Python Tip: Ready to Publish Matplotlib Figures</div>
                  <div class="font-light text-gray-600 text-sm">
                    by Aquiles Carattino, 2020-05-18</div>
                </a>
              </li>
              <li class="mx-4 p-3 border-b border-b-gray-400">
                <a href="https://pythonforthelab.com/blog/data-descriptors-bringing-attributes-next-level" class="font-lg leading-tight hover:font-bold">
                  <div>Data Descriptors: Bringing Attributes to the Next level</div>
                  <div class="font-light text-gray-600 text-sm">
                    by Aquiles Carattino, 2020-05-16</div>
                </a>
              </li>
              <li class="mx-4 p-3 border-b border-b-gray-400">
                <a href="https://pythonforthelab.com/blog/python-tips-using-sets" class="font-lg leading-tight hover:font-bold">
                  <div>Python Tips: Using Sets</div>
                  <div class="font-light text-gray-600 text-sm">
                    by Aquiles Carattino, 2020-05-11</div>
                </a>
              </li>
              <li class="mx-4 p-3 border-b border-b-gray-400">
                <a href="https://pythonforthelab.com/blog/generators-iterables-iterators-python-when-and-where" class="font-lg leading-tight hover:font-bold">
                  <div>Generators, Iterables, Iterators in Python: When and Where</div>
                  <div class="font-light text-gray-600 text-sm">
                    by Aquiles Carattino, 2020-04-10</div>
                </a>
              </li>
          </ul>
      </div>
    </div>
  </div>


<!-- Footer -->
<footer class="w-full bg-black text-white p-8">
  <div class="flex flex-row flex-wrap items-center justify-center gap-y-6 gap-x-12 text-center md:justify-between">
    <img src="https://pythonforthelab.com/theme/css/images/logo-red.svg" alt="logo-ct" class="w-20" />
    <ul class="flex flex-wrap items-center gap-y-2 gap-x-8">
      <li>
        <a
          href="https://pythonforthelab.com/about"
          class="block font-sans text-base font-normal leading-relaxed text-blue-gray-200 antialiased transition-colors hover:text-pink-500 focus:text-pink-500"
        >
          About Us
        </a>
      </li>
      <li>
        <a
          href="https://pythonforthelab.com/cookie-policy"
          class="block font-sans text-base font-normal leading-relaxed text-blue-gray-200 antialiased transition-colors hover:text-pink-500 focus:text-pink-500"
        >
          Cookie Policy
        </a>
      </li>
      <li>
        <a
          href="https://pythonforthelab.com/privacy-policy"
          class="block font-sans text-base font-normal leading-relaxed text-blue-gray-200 antialiased transition-colors hover:text-pink-500 focus:text-pink-500"
        >
          Privacy Policy
        </a>
      </li>
      <li>
        <a
          href="https://pythonforthelab.com/contact-us"
          class="block font-sans text-base font-normal leading-relaxed text-blue-gray-200 antialiased transition-colors hover:text-pink-500 focus:text-pink-500"
        >
          Contact Us
        </a>
      </li>
    </ul>
  </div>
  <hr class="my-8 border-blue-gray-50" />
  <p class="block text-center font-sans text-base font-normal leading-relaxed text-blue-gray-200 antialiased">
    © 2023 Python for the Lab
  </p>
</footer><script src="https://pythonforthelab.com/theme/js/prism.js"></script>
<script src="https://files.stork-search.net/releases/v1.5.0/stork.js"></script>
<script>
    stork.register("sitesearch", "https://pythonforthelab.com/search-index.st");
</script>

<script>
    $(document).ready(function () {
        responsive_menu = $('#menu');
        nav = $('nav');
        $('#menu-button').on('click', function (e) {
            e.preventDefault();
            if (responsive_menu.is(':hidden')) {
                responsive_menu.slideToggle();
                nav.addClass('bg-white');
                $("#site-logo").attr("src", "https://pythonforthelab.com/theme/css/images/logo-classic.svg");
                $('hamburger').slideToggle();
                $('#hamburger').attr('src', 'https://pythonforthelab.com/theme/css/images/cross.svg');
            } else {
                responsive_menu.slideToggle();
                nav.removeClass('bg-white');
                $("#site-logo").attr("src", "https://pythonforthelab.com/theme/css/images/logo-red.svg");
                $('#hamburger').attr('src', 'https://pythonforthelab.com/theme/css/images/hamburger.svg');
            }
        });
        position = $(window).height();
        $(window).scroll(function () {
            var currentScroll = $(window).scrollTop();
            if (currentScroll >= position) {
                $('#sticky_menu').addClass('lg:block');
            } else {
                $('#sticky_menu').removeClass('lg:block');
            }
        });
    });
</script></body>
</html>